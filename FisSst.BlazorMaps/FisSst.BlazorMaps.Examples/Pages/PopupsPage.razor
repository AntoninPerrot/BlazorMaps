@page "/popups"

@inject IJSRuntime JsRuntime
@inject IMarkerFactory MarkerFactory

<div class="top-container">
    <h1 class="page-header">Popups</h1>
</div>

<div class="map-wrapper">
    <Map @ref="MapRef" MapOptions="@MapOptions"></Map>
</div>

<div class="side-panel">
    <h3 class="header">Popups</h3>
    <SidePanelButton Label="add markers"
                     IconSrc="@Icons.PopupsAddMarkersIconSrc"
                     OnClick="async () => await AddMarkers()" />
    <SidePanelButton Label="bind popup"
                     IconSrc="@Icons.PopupsBindPopupIconSrc"
                     OnClick="async () => await BindPopup()" />
    <SidePanelButton Label="remove popup"
                     IconSrc="@Icons.PopupsRemovePopupIconSrc"
                     OnClick="async () => await RemovePopup()" />
    <SidePanelButton Label="update popup"
                     IconSrc="@Icons.PopupsUpdatePopupIconSrc"
                     OnClick="async () => await UpdatePopup()" />
    <SidePanelButton Label="toggle popup"
                     IconSrc="@Icons.PopupsTogglePopupIconSrc"
                     OnClick="async () => await TogglePopup()" />
    <SidePanelButton Class="button-bind-tooltip"
                     Label="bind tooltip"
                     IconSrc="@Icons.PopupsBindTooltipIconSrc"
                     OnClick="async () => await BindTooltip()" />
    <SidePanelButton Class="button-remove-tooltip"
                     Label="remove tooltip"
                     IconSrc="@Icons.PopupsRemoveTooltipIconSrc"
                     OnClick="async () => await RemoveTooltip()" />
    <SidePanelButton Class="button-update-tooltip"
                     Label="update tooltip"
                     IconSrc="@Icons.PopupsUpdateTooltipIconSrc"
                     OnClick="async () => await UpdateTooltip()" />
    <SidePanelButton Class="button-toggle-tooltip"
                     Label="toggle tooltip"
                     IconSrc="@Icons.PopupsToggleTooltipIconSrc"
                     OnClick="async () => await ToggleTooltip()" />
</div>

<style>
    .side-panel {
        min-width: 400px;
        display: grid;
        grid-template-rows: 8vh repeat(4, 12vh);
        grid-template-columns: repeat(3, 1fr);
    }

        .side-panel .header {
            grid-column: 1/-1;
        }

    .button-bind-tooltip {
        grid-row: 4;
        grid-column: 1;
    }

    .button-remove-tooltip {
        grid-row: 4;
        grid-column: 2;
    }

    .button-update-tooltip {
        grid-row: 4;
        grid-column: 3;
    }

    .button-toggle-tooltip {
        grid-row: 5;
        grid-column: 1;
    }
</style>

@code {
    private Map MapRef;

    bool firstRender = true;

    private static readonly LatLng FirstMarkerLatLng = new LatLng(50.284324, 18.664683);
    private static readonly LatLng SecondMarkerLatLng = new LatLng(50.285495, 18.691064);
    private static readonly LatLng ThirdMarkerLatLng = new LatLng(50.279103, 18.685534);

    Marker marker1 = null;
    Marker marker2 = null;

    private MapOptions MapOptions = new MapOptions()
    {
        DivId = "mapId",
        Center = new LatLng(50.279133, 18.685578),
        Zoom = 13,
        UrlTileLayer = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        SubOptions = new MapSubOptions()
        {
            Attribution = "&copy; <a lhref='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>",
            MaxZoom = 18,
            TileSize = 512,
            ZoomOffset = -1,
        }
    };

    protected async Task AddMarkers()
    {
        if (firstRender)
        {
            firstRender = false;
            marker1 = await this.MarkerFactory.CreateAndAddToMap(FirstMarkerLatLng, MapRef);
            marker2 = await this.MarkerFactory.CreateAndAddToMap(SecondMarkerLatLng, MapRef);
        }
    }

    private async Task BindPopup()
    {
        await marker1.BindPopup("Hi! This is a popup");
    }

    private async Task BindTooltip()
    {
        await marker2.BindTooltip("And this is a tooltip");
    }

    private async Task RemovePopup()
    {
        await marker1.UnbindPopup();
    }

    private async Task RemoveTooltip()
    {
        await marker2.UnbindTooltip();
    }

    private async Task UpdatePopup()
    {
        await marker1.SetPopupContent("Popup has changed its content");
    }

    private async Task UpdateTooltip()
    {
        await marker2.SetTooltipContent("Tooltip has changed its content");
    }

    private async Task TogglePopup()
    {
        await marker1.TogglePopup();
    }

    private async Task ToggleTooltip()
    {
        await marker2.ToggleTooltip();
    }
}